import { AudioCtx, download, inlineWorker, logError } from './utils';
function workerBody() {
    var _self = this;
    var config = {
        bufferLen: 4096,
        numChannels: 2,
        mime_type: 'audio/wav',
    };
    var recordBuffer = [];
    _self.onmessage = function (e) {
        switch (e.data.command) {
            case 'record':
                recordData(e.data.val);
                break;
            case 'exportWAV':
                exportWAV();
                break;
        }
    };
    function recordData(inputBuffer) {
        var numChannels = config.numChannels;
        for (var i = 0; i < numChannels; i++) {
            if (!recordBuffer[i]) {
                recordBuffer[i] = [];
            }
            recordBuffer[i].push(inputBuffer[i]);
        }
    }
    function exportWAV() {
        var collectRecord = collect();
        var audioBlob = createAudioBlob(collectRecord);
        recordBuffer = [];
        _self.postMessage({
            command: 'exportWAV',
            val: audioBlob,
        });
    }
    function createAudioBlob(collectRecord) {
        var numChannels = config.numChannels, mime_type = config.mime_type;
        var interleaveData = encodeWAV(44100, numChannels, collectRecord);
        return [
            new Blob([interleaveData], { type: mime_type }),
            interleaveData,
        ];
    }
    function collect() {
        var buffers = [];
        for (var i = 0; i < config.numChannels; i++) {
            buffers.push(mergeBuffers(recordBuffer[i]));
        }
        var length = buffers[0].length + buffers[1].length;
        var result = new Float32Array(length);
        var index = 0;
        var inputIndex = 0;
        while (index < length) {
            result[index++] = buffers[0][inputIndex];
            result[index++] = buffers[1][inputIndex];
            inputIndex++;
        }
        return result;
    }
    function mergeBuffers(buffers) {
        var result = new Float32Array(config.bufferLen * buffers.length);
        var offset = 0;
        for (var i = 0; i < buffers.length; i++) {
            result.set(buffers[i], offset);
            offset += buffers[i].length;
        }
        return result;
    }
    function encodeWAV(sampleRate, numChannels, samples) {
        var dataLength = samples.length * numChannels;
        var buffer = new ArrayBuffer(dataLength + 44);
        var view = new DataView(buffer);
        writeString(view, 0, 'RIFF');
        view.setUint32(4, 36 + dataLength, true);
        writeString(view, 8, 'WAVE');
        writeString(view, 12, 'fmt ');
        view.setUint32(16, 16, true);
        view.setUint16(20, 1, true);
        view.setUint16(22, numChannels, true);
        view.setUint32(24, sampleRate, true);
        view.setUint32(28, sampleRate * numChannels * 2, true);
        view.setUint16(32, numChannels * 2, true);
        view.setUint16(34, 16, true);
        writeString(view, 36, 'data');
        view.setUint32(40, dataLength, true);
        floatTo16BitPCM(view, 44, samples);
        return view;
    }
    function floatTo16BitPCM(output, offset, input) {
        for (var i = 0; i < input.length; i++, offset += 2) {
            var s = Math.max(-1, Math.min(1, input[i]));
            output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
        }
    }
    function writeString(view, offset, string) {
        for (var i = 0; i < string.length; i++) {
            view.setUint8(offset + i, string.charCodeAt(i));
        }
    }
}
var Record = (function () {
    function Record(filename, successFn, errorFn) {
        this.context = AudioCtx;
        this.volume = 1;
        this.errorFn = Record.logError;
        this.worker = Record.inlineWorker(workerBody);
        this.recording = false;
        this.playing = false;
        this.config = {
            bufferLen: 4096,
            numChannels: 2,
        };
        this.filename = filename || 'record';
        this.successFn = successFn || (function () { });
        this.errorFn = errorFn;
        this.listenerWorker();
        this.createEnv();
    }
    Record.prototype.listenerWorker = function () {
        var _this = this;
        this.worker.onmessage = function (e) {
            switch (e.data.command) {
                case 'exportWAV':
                    _this.recordEnded(e.data.val);
                    break;
            }
        };
        this.worker.onerror = this.errorFn;
    };
    Record.prototype.recordEnded = function (_a) {
        var audioBlob = _a[0], interleaveData = _a[1];
        this.audioBlob = audioBlob;
        this.interleaveData = interleaveData.buffer;
        this.audio = null;
        this.recording = false;
        this.successFn();
    };
    Record.prototype.createEnv = function () {
        var _this = this;
        this.connectDevice()
            .then(function (stream) {
            var context = _this.context;
            var _a = _this.config, bufferLen = _a.bufferLen, numChannels = _a.numChannels;
            _this.recorder = context.createScriptProcessor(bufferLen, numChannels, numChannels);
            _this.audioInput = context.createMediaStreamSource(stream);
            _this.recorder.onaudioprocess = function (e) {
                var buffer = [];
                for (var channel = 0; channel < numChannels; channel++) {
                    buffer.push(e.inputBuffer.getChannelData(channel));
                }
                _this.worker.postMessage({
                    command: 'record',
                    val: buffer,
                });
            };
        });
    };
    Record.prototype.connectDevice = function () {
        return navigator.mediaDevices.getUserMedia({ audio: true })
            .then(function (stream) { return stream; })
            .catch(this.errorFn);
    };
    Record.prototype.startRecord = function () {
        var _this = this;
        if (this.recording) {
            return this.errorFn("In recording");
        }
        var connect = function () {
            var _a = _this, audioInput = _a.audioInput, recorder = _a.recorder, context = _a.context;
            if (!audioInput) {
                setTimeout(connect);
                return;
            }
            _this.recording = true;
            _this.audioBlob = null;
            audioInput.connect(recorder);
            recorder.connect(context.destination);
        };
        connect();
    };
    Record.prototype.stopRecord = function () {
        if (!this.recording) {
            return this.errorFn("No recording");
        }
        this.recorder.disconnect();
        this.worker.postMessage({
            command: 'exportWAV'
        });
    };
    Record.prototype.play = function () {
        var _this = this;
        if (this.playing)
            return this.errorFn('Is playing');
        if (!this.audioBlob && !this.audio) {
            return this.errorFn("No audio resources");
        }
        this.playing = true;
        if (!this.audio) {
            this.audio = Record.createAudioElement(this.audioBlob);
            this.audio.volume = this.volume;
            this.audio.onended = function (e) {
                _this.playing = false;
            };
        }
        this.audio.play();
    };
    Record.prototype.pause = function () {
        if (!this.playing) {
            return this.errorFn('Not playing');
        }
        this.audio.pause();
        this.playing = false;
    };
    Record.prototype.download = function () {
        if (this.recording)
            return this.errorFn("In recording");
        if (!this.audioBlob)
            return this.errorFn("Audio blob is [" + this.audioBlob + "]");
        Record.download(this.audioBlob, this.filename + '.wav');
    };
    Record.logError = function (infor, isErr) {
        logError('Record', infor, isErr);
    };
    Record.inlineWorker = function (func) {
        return inlineWorker(func);
    };
    Record.download = function (blob, filename) {
        download(blob, filename);
    };
    Record.createAudioElement = function (blob) {
        var url = window.URL.createObjectURL(blob);
        var audio = document.createElement('audio');
        audio.src = url;
        return audio;
    };
    return Record;
}());
export { Record };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVjb3JkX2F1ZGlvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vbGliL3JlY29yZF9hdWRpby50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE1BQU0sU0FBUyxDQUFBO0FBR3BFO0lBQ0UsSUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFBO0lBQ2xCLElBQU0sTUFBTSxHQUFHO1FBQ2IsU0FBUyxFQUFFLElBQUk7UUFDZixXQUFXLEVBQUUsQ0FBQztRQUNkLFNBQVMsRUFBRSxXQUFXO0tBQ3ZCLENBQUE7SUFDRCxJQUFJLFlBQVksR0FBUyxFQUFFLENBQUE7SUFFM0IsS0FBSyxDQUFDLFNBQVMsR0FBRyxVQUFDLENBQUM7UUFDbEIsTUFBTSxDQUFBLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLEtBQUssUUFBUTtnQkFDWCxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtnQkFDdEIsS0FBSyxDQUFBO1lBQ1AsS0FBSyxXQUFXO2dCQUNkLFNBQVMsRUFBRSxDQUFBO2dCQUNYLEtBQUssQ0FBQTtRQUNULENBQUM7SUFDSCxDQUFDLENBQUE7SUFFRCxvQkFBcUIsV0FBMEI7UUFDN0MsSUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQTtRQUVwQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFdBQVcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ3JDLEVBQUUsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDckIsWUFBWSxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtZQUN0QixDQUFDO1lBQ0QsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxX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